<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> V√≤ng Quay May M·∫Øn üßß</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Audio Player for Prize Music -->
    <audio id="prizeAudio" loop></audio>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            <h1 class="navbar-title">V√≤ng Quay May M·∫Øn </h1>
        </div>
        <div class="navbar-menu">
            <button onclick="toggleControlPanel()" class="navbar-btn" id="controlBtn">
                <svg class="navbar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4">
                    </path>
                </svg>
                <span>ƒêi·ªÅu Khi·ªÉn</span>
            </button>
            <button onclick="togglePrizePanel()" class="navbar-btn" id="prizeBtn">
                <svg class="navbar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7">
                    </path>
                </svg>
                <span>Gi·∫£i Th∆∞·ªüng</span>
            </button>
            <button onclick="openAbsentModal()" class="navbar-btn">
                <svg class="navbar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z">
                    </path>
                </svg>
                <span>Ng∆∞·ªùi V·∫Øng (<span id="navAbsentCount">0</span>)</span>
            </button>
            <div class="navbar-stats">
                <div class="navbar-stat-item">
                    <span class="stat-label-nav">T·ªïng:</span>
                    <span class="stat-value-nav" id="navStatTotal">0</span>
                </div>
                <div class="navbar-stat-item">
                    <span class="stat-label-nav">Tr√∫ng:</span>
                    <span class="stat-value-nav" id="navStatWinners">0</span>
                </div>
                <div class="navbar-stat-item">
                    <span class="stat-label-nav">C√≤n:</span>
                    <span class="stat-value-nav" id="navStatRemaining">0</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Side Panel - ƒêi·ªÅu Khi·ªÉn -->
    <div class="side-panel left-panel" id="controlPanel">
        <div class="panel-header">
            <h2>‚öôÔ∏è ƒêi·ªÅu Khi·ªÉn</h2>
            <button onclick="toggleControlPanel()" class="panel-close">&times;</button>
        </div>
        <div class="panel-body">
            <div class="control-section">
                <h3 class="section-title">üìÅ T·∫£i D·ªØ Li·ªáu</h3>
                <input type="file" id="fileInput" accept=".xlsx,.xls" class="file-input" style="display: none;">
                <button onclick="document.getElementById('fileInput').click()" class="btn btn-upload">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
                        </path>
                    </svg>
                    Ch·ªçn File Excel
                </button>
            </div>

            <div class="control-section">
                <h3 class="section-title">üéÅ Ch·ªçn Gi·∫£i</h3>
                <select id="prizeSelect" class="select-input">
                    <option value="">Ch·ªçn gi·∫£i th∆∞·ªüng...</option>
                </select>
            </div>

            <div class="control-section">
                <button id="spinBtn" onclick="handleSpin()" class="btn btn-spin btn-large" disabled>
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z">
                        </path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span id="spinBtnText">QUAY NGAY!</span>
                </button>
            </div>

            <div class="control-section">
                <h3 class="section-title">üìä Thao T√°c</h3>
                <div class="action-grid">
                    <button onclick="exportWinners()" class="btn btn-export">
                        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        Xu·∫•t Ng∆∞·ªùi Tr√∫ng
                    </button>
                    <button onclick="exportAbsent()" class="btn btn-warning">
                        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        Xu·∫•t Ng∆∞·ªùi V·∫Øng
                    </button>
                    <button onclick="handleReset()" class="btn btn-reset">
                        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                            </path>
                        </svg>
                        Reset
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Side Panel - Gi·∫£i Th∆∞·ªüng -->
    <div class="side-panel right-panel" id="prizePanel">
        <div class="panel-header">
            <h2>üèÜ Gi·∫£i Th∆∞·ªüng</h2>
            <button onclick="togglePrizePanel()" class="panel-close">&times;</button>
        </div>
        <div class="panel-body">
            <div class="control-section">
                <h3 class="section-title">‚ûï Th√™m Gi·∫£i M·ªõi</h3>
                <input type="text" id="prizeName" placeholder="T√™n gi·∫£i th∆∞·ªüng" class="text-input">
                <div class="prize-inputs">
                    <div class="input-group">
                        <label class="input-label-small">S·ªë gi·∫£i:</label>
                        <input type="number" id="prizeQuantity" value="1" min="1" class="text-input number-input">
                    </div>
                    <div class="input-group">
                        <label class="input-label-small">Ng∆∞·ªùi/gi·∫£i:</label>
                        <input type="number" id="winnersPerPrize" value="1" min="1" class="text-input number-input">
                    </div>
                </div>
                <div class="music-upload-section">
                    <label class="input-label-small">üéµ Nh·∫°c h·ªìi h·ªôp:</label>
                    <div class="music-tabs">
                        <button class="music-tab-btn active" onclick="switchMusicTab('file')">üìÅ Upload File</button>
                        <button class="music-tab-btn" onclick="switchMusicTab('url')">üåê URL</button>
                    </div>

                    <!-- Tab Upload File -->
                    <div id="musicFileTab" class="music-tab-content active">
                        <input type="file" id="prizeMusic" accept="audio/*" class="file-input-music"
                            style="display: none;">
                        <button onclick="document.getElementById('prizeMusic').click()" class="btn btn-music-upload">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3">
                                </path>
                            </svg>
                            <span id="musicFileName">Ch·ªçn nh·∫°c</span>
                        </button>
                    </div>

                    <!-- Tab URL -->
                    <div id="musicUrlTab" class="music-tab-content">
                        <input type="text" id="prizeMusic Url" placeholder="Nh·∫≠p URL nh·∫°c (http://... ho·∫∑c https://...)"
                            class="text-input">
                        <small class="music-hint">V√≠ d·ª•: https://example.com/music.mp3</small>
                    </div>
                </div>
                <button onclick="handleAddPrize()" class="btn btn-add-prize">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Th√™m Gi·∫£i
                </button>
            </div>

            <div class="control-section">
                <h3 class="section-title">üìã Danh S√°ch Gi·∫£i</h3>
                <div id="prizeList" class="prize-scroll">
                    <p class="prize-empty">üéÅ Ch∆∞a c√≥ gi·∫£i th∆∞·ªüng</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="tet-decorations">
            <div class="petal">üßß</div>
            <div class="petal">üßß</div>
            <div class="petal">üßß</div>
            <div class="petal">üßß</div>
            <div class="petal">üßß</div>
            <div class="petal">üßß</div>
        </div>

        <div class="roll-section">
            <div class="roll-header">
                <h2 class="roll-title">üé° QUAY S·ªê MAY M·∫ÆN üé°</h2>
            </div>

            <div class="roll-container-new" id="rollContainer">
                <div class="roll-grid-new" id="rollGrid"></div>

                <button id="centerSpinBtn" onclick="handleSpin()" class="center-spin-button-new" disabled>
                    <div class="spin-icon-new">üé≤</div>
                    <div class="spin-text-new">QUAY S·ªê</div>
                </button>
            </div>

            <div id="winnerDisplay" class="winner-placeholder">
                <p class="placeholder-text">üßß Nh·∫•n n√∫t ƒë·ªÉ quay! üßß</p>
            </div>
        </div>
    </main>

    <!-- Admin Panel - Enhanced -->
    <div id="adminPanel" class="admin-panel">
        <div class="admin-header">
            <h3>üîê ADMIN CONTROL</h3>
            <button onclick="closeAdminPanel()" class="admin-close">&times;</button>
        </div>
        <div class="admin-body">
            <!-- <div class="admin-info">
            <p>‚ö†Ô∏è <strong>Ch·ª©c nƒÉng b√≠ m·∫≠t</strong> - Setup ng∆∞·ªùi tr√∫ng tr∆∞·ªõc</p>
            <p class="admin-hint">üí° Ch·ªçn ng∆∞·ªùi + gi·∫£i, sau ƒë√≥ th√™m v√†o danh s√°ch. Khi quay gi·∫£i ƒë√≥, ng∆∞·ªùi setup s·∫Ω
                t·ª± ƒë·ªông tr√∫ng!</p>
        </div> -->

            <!-- Step 1: Ch·ªçn ng∆∞·ªùi -->
            <div class="admin-section">
                <h4 class="admin-section-title"> Ch·ªçn ng∆∞·ªùi:</h4>
                <div class="admin-search">
                    <input type="text" id="adminSearch" placeholder="T√¨m ki·∫øm..." class="admin-search-input"
                        onkeyup="filterAdminList()">
                </div>
                <div id="adminParticipantList" class="admin-list">
                    <p class="admin-empty">Ch∆∞a t·∫£i d·ªØ li·ªáu</p>
                </div>
            </div>

            <!-- Step 2: Ch·ªçn gi·∫£i -->
            <div class="admin-section">
                <h4 class="admin-section-title"> Ch·ªçn gi·∫£i:</h4>
                <select id="adminPrizeSelect" class="admin-prize-select" onchange="selectAdminPrize()">
                    <option value="">-- Ch·ªçn gi·∫£i --</option>
                </select>
            </div>

            <!-- Current Selection -->
            <div class="admin-current">
                <h4 class="admin-section-title">ƒêang ch·ªçn:</h4>
                <div id="adminCurrentSelection" class="admin-current-box">
                    <span class="admin-no-selection">Ch∆∞a ch·ªçn ng∆∞·ªùi v√† gi·∫£i</span>
                </div>
                <div class="admin-action-buttons">
                    <button onclick="addToPreset()" class="btn-admin-add">
                        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4">
                            </path>
                        </svg>
                        Th√™m v√†o danh s√°ch
                    </button>
                    <button onclick="clearAdminSelection()" class="btn-admin-clear">H·ªßy ch·ªçn</button>
                </div>
                <div id="adminNotification" class="admin-notification"></div>
            </div>

            <!-- Preset List -->
            <div class="admin-section">
                <div class="admin-preset-header">
                    <h4 class="admin-section-title">üìã Danh s√°ch Setup (<span id="presetCount">0</span>)</h4>
                    <button onclick="clearAllPresets()" class="btn-admin-clear-all">X√≥a t·∫•t c·∫£</button>
                </div>
                <div id="adminPresetList" class="admin-preset-scroll">
                    <p class="admin-empty">Ch∆∞a c√≥ setup n√†o</p>
                </div>
            </div>
        </div>

        <!-- Absent Modal -->
        <div id="absentModal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>üö´ Qu·∫£n L√Ω Ng∆∞·ªùi V·∫Øng</h2>
                    <button onclick="closeAbsentModal()" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="modal-info-bar">
                        <div class="info-item">
                            <span class="info-icon">üë•</span>
                            <span>T·ªïng: <strong id="totalWinnersCount">0</strong></span>
                        </div>
                        <div class="info-item">
                            <span class="info-icon">‚úÖ</span>
                            <span>C√≥ m·∫∑t: <strong id="presentCount">0</strong></span>
                        </div>
                        <div class="info-item">
                            <span class="info-icon">‚ùå</span>
                            <span>V·∫Øng: <strong id="absentCountModal">0</strong></span>
                        </div>
                    </div>
                    <p class="modal-description">Click ƒë·ªÉ ƒë√°nh d·∫•u v·∫Øng/c√≥ m·∫∑t</p>
                    <div class="search-bar">
                        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <input type="text" id="searchAbsent" placeholder="T√¨m ki·∫øm..." class="search-input-new"
                            onkeyup="filterWinners()">
                    </div>
                    <div id="winnerListModal" class="participant-grid">
                        <p class="participant-empty">Ch∆∞a c√≥ ng∆∞·ªùi tr√∫ng</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button onclick="exportAbsent()" class="btn btn-export-modal">
                        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        Xu·∫•t V·∫Øng
                    </button>
                    <button onclick="closeAbsentModal()" class="btn btn-close-modal">ƒê√≥ng</button>
                </div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
        <script src="script.js"></script>
</body>

</html>